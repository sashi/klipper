var h=Object.defineProperty;var u=(s,r,t)=>r in s?h(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t;var o=(s,r,t)=>(u(s,typeof r!="symbol"?r+"":r,t),t);import{m as y,f as d,C as f,R as C,e as _}from"./index-495254bb.js";import{C as v}from"./camera-10ebe931.js";var b=Object.defineProperty,S=Object.getOwnPropertyDescriptor,p=(s,r,t,i)=>{for(var e=i>1?void 0:i?S(r,t):r,a=s.length-1,n;a>=0;a--)(n=s[a])&&(e=(i?n(r,t,e):n(e))||e);return i&&e&&b(r,t,e),e};let m=class extends y(v){constructor(){super(...arguments);o(this,"cameraVideo");o(this,"pc",null);o(this,"remoteId",null)}startPlayback(){var i;const t=this.buildAbsoluteUrl(this.camera.urlStream||"");(i=this.pc)==null||i.close(),fetch(t,{body:JSON.stringify({type:"request"}),headers:{"Content-Type":"application/json"},method:"POST"}).then(e=>e.json()).then(e=>{var n;this.remoteId="id"in e&&typeof e.id=="string"?e.id:null;const a={sdpSemantics:"unified-plan"};return"iceServers"in e&&Array.isArray(e.iceServers)&&(a.iceServers=e.iceServers),this.pc=new RTCPeerConnection(a),this.pc.addTransceiver("video",{direction:"recvonly"}),this.pc.ontrack=c=>{c.track.kind==="video"&&(this.cameraVideo.srcObject=c.streams[0])},this.pc.onicecandidate=c=>{if(c.candidate)return fetch(t,{body:JSON.stringify({type:"remote_candidate",id:this.remoteId,candidates:[c.candidate]}),headers:{"Content-Type":"application/json"},method:"POST"}).catch(l=>d.error("[WebrtcCamerastreamerCamera] onicecandidate",l))},(n=this.pc)==null?void 0:n.setRemoteDescription(e)}).then(()=>{var e;return(e=this.pc)==null?void 0:e.createAnswer()}).then(e=>{var a;return(a=this.pc)==null?void 0:a.setLocalDescription(e)}).then(()=>{var a;const e=(a=this.pc)==null?void 0:a.localDescription;return fetch(t,{body:JSON.stringify({type:e==null?void 0:e.type,id:this.remoteId,sdp:e==null?void 0:e.sdp}),headers:{"Content-Type":"application/json"},method:"POST"})}).then(e=>e.json()).catch(e=>d.error("[WebrtcCamerastreamerCamera] setUrl",e))}stopPlayback(){var t;(t=this.pc)==null||t.close(),this.pc=null,this.cameraVideo.src=""}};p([C("streamingElement")],m.prototype,"cameraVideo",2);m=p([f({})],m);var P=function(){var r=this,t=r._self._c;return r._self._setupProxy,t("video",{ref:"streamingElement",style:r.cameraStyle,attrs:{autoplay:"",muted:"",crossorigin:"anonymous"},domProps:{muted:!0}})},O=[],g=_(m,P,O,!1,null,null,null,null);const R=g.exports;export{R as default};
